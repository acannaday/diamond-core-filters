#
#       SnapFind (Release 0.9)
#       An interactive image search application
#
#      Copyright (c) 2002-2005, Intel Corporation
#      All Rights Reserved
#
#  This software is distributed under the terms of the Eclipse Public
#  License, Version 1.0 which can be found in the file named LICENSE.
#  ANY USE, REPRODUCTION OR DISTRIBUTION OF THIS SOFTWARE CONSTITUTES
#  RECIPIENT'S ACCEPTANCE OF THIS AGREEMENT
#

ROOTDIR = @top_srcdir@
VPATH = @srcdir@
SRCDIR = @srcdir@
OBJROOT = @OBJROOT@
CVCPPFLAGS = @CVCPPFLAGS@
CVLDFLAGS = @CVLDFLAGS@

GTK_LDFLAGS = @GTK_LDFLAGS@
GTK_CPPFLAGS = @GTK_CPPFLAGS@

# use the GTK values when building this code
CPPFLAGS += ${GTK_CPPFLAGS}
CPPFLAGS += ${CVCPPFLAGS}

LDFLAGS += ${CVLDFLAGS}

# 
# Set the libraries and the library paths we will need
# to build these files.
LIBS += -ldl -lfl -lpthread -lm 
LIBS += -Wl,-whole-archive -lsearchlet -lfilterexec -lfilter -llog 
LIBS += -Wl,-no-whole-archive -lfl -lodisk -ltools
LIBS += -lhstub -ldctl -ldconfig
LIBS += -llog -lssl -ltiff -lz

CVLIBS += -Wl,-static -lcvaux -lopencv -Wl,-call_shared 

include $(ROOTDIR)/common/Makefile.template

# objects used to build the searchlet(s)
SEARCHLET_SRCS = $(COMMON_SEARCHLET_SRCS) $(COMMON_SHARED_SRCS)

SEARCHLET_OBJS = $(COMMON_SEARCHLET_OBJS) $(COMMON_SHARED_OBJS)

SEARCHLET_LIBS += -lm -Wl,-static -lcvaux -lopencv -ltiff -ljpeg -lz

SEARCHLET_LIBDIR += 

# objects needed to build the main
SNAPFIND_SRCS = $(COMMON_APP_SRCS) $(COMMON_SHARED_SRCS)
SNAPFIND_SRCS += snapfind.cc sfind_search.cc
SNAPFIND_SRCS +=  read_config.cc  stats_win.c
SNAPFIND_SRCS += progress_win.cc rgb.c   
SNAPFIND_SRCS += snap_popup.cc graph_win.cc cache_control.cc
SNAPFIND_SRCS += sfind_tools.c   factory.cc

SNAPFIND_OBJS = $(COMMON_APP_OBJS) $(COMMON_SHARED_OBJS)
SNAPFIND_OBJS += snapfind.o sfind_search.o read_config.o 
SNAPFIND_OBJS += progress_win.o snap_popup.o  stats_win.o
SNAPFIND_OBJS += fil_histo.o graph_win.o cache_control.o
SNAPFIND_OBJS += sfind_tools.o  factory.o

DEBUG_SRCS = face.c
DEBUG_OBJS = face.o

#
# All the source files that are needed for depend.
#
SRCS = $(SNAPFIND_SRCS) $(SEARCHLET_SRCS) $(DEBUG_SRCS)
OBJS = $(SNAPFIND_OBJS) $(SEARCHLET_OBJS) $(DEBUG_OBJS)

#
# Compilation Targets
#


#
# Other objects to cleanup
CLEAN_OTHERS += read_config.cc $(COMMON_SRCS)

TARGETS = $(COMMON_HEADERS) snapfind snap_searchlet.so

SHARED_BIN += snap_searchlet.so snapfind 

include ${OBJROOT}/Makefile.template


ifeq ($(OSTYPE),linux)
DYNAMIC = -rdynamic
endif

ifeq ($(OSTYPE),darwin)
DYNAMIC = -dynamic
endif

cln:
	$(RM) core.*
	$(RM) /tmp/fspec* /tmp/filsp* /tmp/objfil*
	$(RM) /var/tmp/fspec* /var/tmp/filsp* /var/tmp/objfil*

clean-targets:	clean-experiments
	$(RM) $(TARGETS)

default: $(TARGETS)

snap_searchlet.so: $(SEARCHLET_OBJS)
	$(CPLUSPLUS) $(CFLAGS_SO) $(LDFLAGS) -o $@ -shared -static $(SEARCHLET_OBJS) $(SEARCHLET_LIBS) $(SEARCHLET_LIBDIR)

libssearch.a: $(SEARCHLET_OBJS)
	$(AR) r $@ $(SEARCHLET_OBJS)


snapfind: $(SNAPFIND_OBJS)
	$(CPLUSPLUS) $(CFLAGS) $(DYNAMIC) -o $@ $(SNAPFIND_OBJS) $(LIBS) $(LDFLAGS) $(GTK_LDFLAGS) ${CVLIBS}


search:	search.c
	$(CC) $(CFLAGS) $(DYNAMIC) -o $@ $< $(LIBDIR) `pkg-config gtk+-2.0 gthread-2.0 --cflags --libs`

profile: profile.o $(SEARCHLET_OBJS)
	$(CC) $(CFLAGS) -o profile profile.o $(SEARCHLET_OBJS) $(LIBS) $(LIBDIR) -lfilterexec -ltools -lodisk

foo: foo.o rgb_histo_search.o snap_search.o window_search.o example_search.o
	$(CC) $(CFLAGS) -o foo foo.o rgb_histo_search.o snap_search.o window_search.o example_search.o


#	$(CC) $(CFLAGS) -o $@ $< $(SEARCHLET_OBJS) $(LIBS) $(LIBDIR) -lfilterexec -ltools -lodisk

wavelet-test:	wavelet.o rgb.o
	$(CC) $(CFLAGS) -o wavelet-test wavelet.o rgb.o -static -lwvlt -lm
