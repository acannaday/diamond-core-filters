#
#  SnapFind
#  An interactive image search application
#  Version 1
#
#  Copyright (c) 2002-2005 Intel Corporation
#  All Rights Reserved.
#
#  This software is distributed under the terms of the Eclipse Public
#  License, Version 1.0 which can be found in the file named LICENSE.
#  ANY USE, REPRODUCTION OR DISTRIBUTION OF THIS SOFTWARE CONSTITUTES
#  RECIPIENT'S ACCEPTANCE OF THIS AGREEMENT
#

ROOTDIR = @top_srcdir@
VPATH = @srcdir@
SRCDIR = @srcdir@
OBJROOT = @OBJROOT@
CVCPPFLAGS = @CVCPPFLAGS@
CVLDFLAGS = @CVLDFLAGS@

GTK_LIBS = @GTK_LIBS@
GTK_CFLAGS = @GTK_CFLAGS@

# use the GTK values when building this code
CPPFLAGS += ${GTK_CFLAGS}

# 
# Set the libraries and the library paths we will need
# to build these files.
LIBS += @OPENDIAMOND_LIBS@ -Wl,-\( -ltiff -lz -lsfgtk -lsfimage -lresults -ljpeg -Wl,-\)

# objects used to build the searchlet(s)
SEARCHLET_SRCS = 

SEARCHLET_OBJS = 

SEARCHLET_LIBS += -Wl,-\( -lm -lsfimage -ltiff -ljpeg -lz -Wl,-\)

SEARCHLET_LIBDIR += 

# objects needed to build the main
SNAPFIND_SRCS = $(COMMON_APP_SRCS) $(COMMON_SHARED_SRCS)
SNAPFIND_SRCS += snapfind.cc sfind_search.cc
SNAPFIND_SRCS +=  read_config.cc  stats_win.c
SNAPFIND_SRCS += progress_win.cc    
SNAPFIND_SRCS += snap_popup.cc graph_win.cc cache_control.cc
SNAPFIND_SRCS += sfind_tools.c   factory.cc  example_search.cc
SNAPFIND_SRCS += gtk_image_tools.c import_sample.cc display_img.cc
SNAPFIND_SRCS += window_search.cc img_search.cc search_support.cc 
SNAPFIND_SRCS += search_set.cc plugin.cc attr_ent.cc attr_info.cc
SNAPFIND_SRCS += decoder.cc  std_decoders.cc attr_decode.cc
SNAPFIND_SRCS += attr_map.cc log_win.cc

SNAPFIND_OBJS = $(COMMON_APP_OBJS) $(COMMON_SHARED_OBJS)
SNAPFIND_OBJS += snapfind.o sfind_search.o read_config.o 
SNAPFIND_OBJS += progress_win.o snap_popup.o  stats_win.o
SNAPFIND_OBJS += graph_win.o cache_control.o
SNAPFIND_OBJS += sfind_tools.o  factory.o example_search.o
SNAPFIND_OBJS += gtk_image_tools.o import_sample.o display_img.o
SNAPFIND_OBJS += window_search.o img_search.o search_support.o
SNAPFIND_OBJS += search_set.o snapfind_config.o plugin.o plugin_conf.o
SNAPFIND_OBJS += attr_ent.o attr_info.o
SNAPFIND_OBJS += decoder.o std_decoders.o attr_decode.o
SNAPFIND_OBJS += attr_map.o log_win.o 


DEBUG_SRCS = face.c
DEBUG_OBJS = face.o

#
# All the source files that are needed for depend.
#
SRCS = $(SNAPFIND_SRCS) $(SEARCHLET_SRCS) $(DEBUG_SRCS)
OBJS = $(SNAPFIND_OBJS) $(SEARCHLET_OBJS) $(DEBUG_OBJS)


#
# Compilation Targets
#


#
# Other objects to cleanup
CLEAN_OTHERS += read_config.cc 

TARGETS =  snapfind 

SHARED_BIN += snapfind 

SHARED_LIB += 

SHARED_HEADERS = img_search.h search_set.h factory.h snapfind_config.h

include ${OBJROOT}/Makefile.template


DYNAMIC = -rdynamic

ifeq ($(OSTYPE),darwin)
DYNAMIC = -dynamic
endif

cln:
	$(RM) core.*
	$(RM) /tmp/fspec* /tmp/filsp* /tmp/objfil* /tmp/haar*
	$(RM) /var/tmp/fspec* /var/tmp/filsp* /var/tmp/objfil* /var/tmp/haar*

clean-targets:	clean-experiments
	$(RM) $(TARGETS)

default: $(TARGETS)

snap_searchlet.so: $(SEARCHLET_OBJS)
	$(CPLUSPLUS) $(CFLAGS_SO) $(LDFLAGS) -o $@ -shared -static $(SEARCHLET_OBJS) $(SEARCHLET_LIBS) $(SEARCHLET_LIBDIR)

libssearch.a: $(SEARCHLET_OBJS)
	$(AR) r $@ $(SEARCHLET_OBJS)


snapfind: $(SNAPFIND_OBJS)
	$(CPLUSPLUS) $(CFLAGS) $(DYNAMIC) -o $@ $(SNAPFIND_OBJS) $(LIBS) $(LDFLAGS) $(GTK_LIBS) 

